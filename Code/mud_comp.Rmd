---
title: "Mud Migration Community Compositon"
output: html_notebook
---
# Install packages if needed
```{r install_packages}
#install.packages("googlesheets4")
#install.packages("googledrive")
#install.packages("tidyverse")
```

# Load packages
```{r load_packages}
library(googlesheets4)
library(googledrive)
library(tidyverse)
```

# Connect to google account
Deauthorize google account to allow universal access to the raw data sheet.Then retrive data sheet from where it's stored on google drive.
```{r connect_google}
gs4_deauth()
googlesheet_url <- "https://docs.google.com/spreadsheets/d/1Ga0qnVxOVR9NwSNI5RM1iz1L2MoCAyF0O4x3D6mCePw/edit?gid=405129858#gid=405129858"
```

# Accessing sheets
```{r accessing_sheets}
community_composition <- read_sheet(googlesheet_url, sheet = "community_composition")
raw_cell_measurements <- read_sheet(googlesheet_url, sheet = "raw_cell_measurements")
data_dictionary <- read_sheet(googlesheet_url, sheet = "data_dictionary")
```

# Set missing width_1 values to equal 1um 
```{r mutate_width1}
raw_cell_measurements_2 <- raw_cell_measurements |>
  mutate(Width1_um = case_when(
    is.na(Width1_um) ~ 1,
    TRUE ~ Width1_um
  ))
```

#Calculate Surface Area:

##Centric surface area calculations
```{r centric_areas}
raw_cell_measurements_2$Centric_Area <- ifelse(raw_cell_measurements_2$CellMorphotype == "centric", raw_cell_measurements_2$Width1_um * raw_cell_measurements_2$Width2_um, NA)
```

##Pennate surface area calculations
```{r pennate_areas}
raw_cell_measurements_2$Pennate_Area <- ifelse(raw_cell_measurements_2$CellMorphotype == "pennate", raw_cell_measurements_2$Length_um * raw_cell_measurements_2$Width1_um, NA)
```

##'Peanut'surface area calculations
```{r peanut_areas}
raw_cell_measurements_2$Peanut_Area <- ifelse(raw_cell_measurements_2$CellMorphotype == "peanut", raw_cell_measurements_2$Length_um * raw_cell_measurements_2$Width1_um, NA)
```

##Combine surface area results into one column
```{r combined_areas}
raw_cell_measurements_2$Surface_Area <- rowSums(raw_cell_measurements_2[, c("Centric_Area", "Pennate_Area", "Peanut_Area")], na.rm = TRUE)
```

#Bin surface areas
```{r bin_areas}
# equal breaks
#raw_cell_measurements_2$Surface_Area_Bins <- cut(raw_cell_measurements_2$Surface_Area, breaks = 5, labels = FALSE)

# custom bin ranges
#bin_ranges <- c(0, 10, 20, 30, 40, 50)
#raw_cell_measurements_2$Surface_Area_Bins <- cut(raw_cell_measurements_2$Surface_Area, breaks = bin_ranges, include.lowest = TRUE)
```

#Merge common value between raw data and conditions
```{r merge_sheets}
merged_data <- merge(sheet_data, raw_cell_measurements_2, by = "SamplePhotoID", all.x = TRUE)
```

