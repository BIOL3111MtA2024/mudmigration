---
title: "ChlorLine"
output: html_notebook
---

# Introduction

This .rmd reads chlorophyll data and generates a line graph ...

# Install packages if needed

```{r install_packages}
#install.packages("tidyverse")
#install.packages("kableExtra")
```

# Loading Packages

```{r load packages}
library(tidyverse) 
library(kableExtra)
```

```{r read_vert_migration}
vert_migration <- readRDS( file = file.path("..","Data","CleanData","vert_migration.rds"))
```

```{r chlor_time}
vert_migration |>
  ggplot() +
  geom_point(aes(x = ToD, y = Chl_ugcm2), alpha = 0.7) +  
  facet_grid(rows = vars(Top_Bottom), cols = vars(Temp_C)) + 
  labs(
    x = "Time of Day", 
    y = expression("Chlorophyll Concentration ("*mu*"g / cm"^2*")"),  
    title = "Chlorophyll Concentrations Across Temperatures", 
    subtitle = "Analyzing chlorophyll concentration at hight tide in the Bay of Fundy at 15°C, 20°C, and 25°C", 
    
  ) +
  theme(
    axis.text.x = element_text(angle = 90, vjust = 0.5, hjust = 1), # Rotate x-axis labels for readability
    panel.background = element_rect(fill = "gray90"),  
    panel.grid.major = element_line(color = "white"), 
    panel.grid.minor = element_blank(),  
    strip.background = element_rect(fill = "lightgray"), 
    strip.text = element_text(face = "bold") 
  )

```

# Create top and bottom ratio

vert_migration contains variable Top_Bottom To simplify ratio calculation we 'pivot_wider' the data to separate Top_Bottom into two separate variables, Top & Bottom; that will lower the number of rows and increase the number of columns

```{r top_bottom}
vert_migration_wide <- vert_migration |>
  select(-c(Tissue_Area_cm2, VolSol_mL, Fluorescence_Reading, `...19`,  Chl_ugL)) |>
  pivot_wider(id_cols = c(YYYYMMDDHHMM, Replicate, Temp_C, Light, Trial, DateTime, Date, ToD, E_time_h), names_from = Top_Bottom, values_from = Chl_ugcm2, values_fn = mean) |>
  mutate(TopBottomRatio = top/bottom)

#hack solution to cope with ambiguous row labelling by taking 'mean' of rows with multiple values.

```

Plot ratio of Top Chl_ugcm2 divided by Bottom Chl_ugcm2

```{r}
vert_migration_wide |>
  ggplot() +
  geom_point(aes(x = ToD, y = TopBottomRatio), alpha = 0.7) +
  geom_smooth(aes(x = ToD, y = TopBottomRatio), method = "lm", se = FALSE, color = "blue", linetype = "dashed") +
  facet_grid(cols = vars(Temp_C)) +
  labs(
    x = "Time of Day", 
    y = "Top to Bottom Ratio", 
    title = "Ratio of Top Chlorophyll µg·cm^2 To Bottom Chlorophyll µg·cm^2",subtitle = "Analyzing chlorophyll concentration top to bottom ratios at temperatures 15°C, 20°C, and 23°C", 
  ) +
  theme(
    axis.text.x = element_text(angle = 90, vjust = 0.5, hjust = 1),
    panel.background = element_rect(fill = "gray90"),
    panel.grid.major = element_line(color = "white"),
    panel.grid.minor = element_blank(),
    strip.background = element_rect(fill = "lightgray"),
    strip.text = element_text(face = "bold")
  )
```

General trends:

At 15°C there is a broader spread of ratios and the highest amount of ratios exceeding 2. This shows that the highest concentration of chlorophyll was found on these papers, suggesting the highest amplitude of migration happens at 15°C.

At 20°C ratios are generally lower, slightly below 2, with one exceeding 2.

At 23°C ratios are all below 1, indicating the lowest amplitude of migration happens at 23°C and shows the least variability between the three temperatures.

The broader range of ratios at 15°C could indicate more vertical migration at lower temperatures. The decreasing range of ratios as the temperature increased from 15°C to 23°C suggests there is some temperature dependence in migration patterns of diatoms.

Plot Top Chl_ugcm2 vs Bottom Chl_ugcm2 with visual representation of time of day.

```{r plot Top Chl_ugcm2 vs. Bottom Chl_ugcm2}
vert_migration_wide |>
  ggplot() +
  geom_point(aes(x = bottom, y = top, size = ToD, color = ToD), alpha = 0.7) +
  
  facet_grid(cols = vars(Temp_C)) +  
  labs(
    x = "Bottom Chlorophyll (µg/cm²)", 
    y = "Top Chlorophyll (µg/cm²)", 
    title = "Top and Bottom Chlorophyll Concentration by Temperature",
    subtitle = "Point size and color represent Time of Day",
    
  ) +
  theme(
    axis.text.x = element_text(angle = 45, hjust = 1),  
    axis.text.y = element_text(angle = 0, hjust = 1),  
    panel.background = element_rect(fill = "white"),  
    panel.grid.major = element_line(color = "gray90"),  
    panel.grid.minor = element_blank(),  
    strip.background = element_rect(fill = "lightgray"),  
    strip.text = element_text(face = "bold")  
  )

```

Analysis:

The graph displays the ratio of chlorophyll concentration (top to bottom) across different times of the day, grouped by three temperature categories: 15°C, 20°C, 23°C.

Since ratios are predominantly below 2, it shows a general trend where the top surface has slightly more chlorophyll than the bottom, indicating that these diatoms are exhibiting vertical migration in some capacity.

As time progresses, time slot 14:30 shows consistently higher ratios, especially at 15°C. This suggests that migration is increasing with time.

Temperature 15°C shows higher maximum ratios, while 20°C and 23°C show moderate ranges in ratios.

At 15°C the data shows the highest variation with the most extreme values out of the three temperatures, indicating that at 15°C there is greater concentration of chlorophyll at the top surface compared to the bottom. Temperatures 20°C and 23°C have less pronounced variations, suggesting that these conditions lead to a more balanced chlorophyll distribution between the top and bottom surfaces.
